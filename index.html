<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>Divide and Conquer</title>

		<meta name="description" content="Lecture about Clean Architecture">
		<meta name="author" content="Pablo Aguilar">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h3>Divide and Conquer - Workshop</h3>
					<p>
						<small><a href="https://github.com/thepabloaguilar/">@thepabloaguilar</a></small>
					</p>
				</section>

				<section>
					<section>
						<h1>Divide</h1>
						<h4>the code</h4>
						<h1>Conquer</h1>
						<h4>maintainability</h4>
					</section>
					<section>
						<h5>We can divide our code in many ways, sometimes this division is called:</h5>
						<ul>
							<li>Design Pattern</li>
							<li>Architectural Design Patterns</li>
						</ul>
					</section>
					<section>
						In the end, everything is about how we can organize our code to make it more understandable,
						maintainable and team-friendly
					</section>
				</section>

				<section data-auto-animate>
					<h2 data-id="code-title">Flask minimal application</h2>
					<pre data-id="code-animation">
						<code class="python" data-trim data-line-numbers>
							from flask import Flask

							app = Flask(__name__)

							@app.route('/')
							def hello_world():
							  return 'Hello, World!'
						</code>
					</pre>
				</section>
				<section data-auto-animate>
					<h2 data-id="code-title">Flask + Database</h2>
					<pre data-id="code-animation">
						<code class="python" data-trim data-line-numbers="|1-5|7-13|15-21">
							from flask import Flask

							app = Flask(__name__)
							app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////.db'
							db = SQLAlchemy(app)

							class User(db.Model):
							  id = db.Column(db.Integer, primary_key=True)
							  username = db.Column(db.String(80), unique=True, nullable=False)
							  email = db.Column(db.String(120), unique=True, nullable=False)

							  def __repr__(self):
							    return '&lt;User %r&gt;' % self.username
							
							@app.route('/')
							def hello_world():
							  return 'Hello, World!'
							
							@app.route('/users', methods=['GET'])
							def get_users():
							  return User.query.all()
						</code>
					</pre>
				</section>
				<section data-auto-animate>
					<h3 data-id="code-title">Flask + Database + Marshmallow</h3>
					<pre data-id="code-animation">
						<code class="python" data-trim data-line-numbers="|17-19|29-45|31-36|38-39|40-46|48">
							from flask import Flask, request
							from flask_sqlalchemy import SQLAlchemy
							from marshmallow import Schema, fields, ValidationError

							app = Flask(__name__)
							app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////.db'
							db = SQLAlchemy(app)

							class User(db.Model):
							  id = db.Column(db.Integer, primary_key=True)
							  username = db.Column(db.String(80), unique=True, nullable=False)
							  email = db.Column(db.String(120), unique=True, nullable=False)

							  def __repr__(self):
							    return '&lt;User %r&gt;' % self.username
							
							class UserSchema(Schema):
							  username = fields.Str()
							  email = fields.Email()
							
							@app.route('/')
							def hello_world():
							  return 'Hello, World!'
							
							@app.route('/users', methods=['GET'])
							def get_users():
							  return User.query.all()
							
							@app.route('/users', methods=['POST'])
							def create_user():
							  user_data = request.json

							  try:
							    validated_user_data = UserSchema().load(user_data)
							  except ValidationError as err:
							    return err.messages, 400
                                
							  # We can have business logic here to validate something about the user
							  if is_valid_user(validated_user_data):
							    user = User(validated_user_data.username, validated_user_data.email)
							    try:
							      db.session.add(user)
							      db.session.commit()
							    except Exception as ex:
							      db.session.rollback()
							      return str(ex), 503
							  
							  return user
						</code>
					</pre>
				</section>

				<section>
					<section>
						<h3>If you do not choose the application architecture other people will choose for you</h3>
					</section>
					<section>
						<h4>Sometimes your framework will choose for you, see the big example here:</h4>
						<img src="images/django-logo.png" />
					</section>
					<section>
						<p>
							Django enforces you to use its own architecture, you can try to modify it but
							if a plugin or something needs the original structure you can have some problems
						</p>
					</section>
				</section>

				<section>
					<section>
						<p>Here, I'm going to talk about:</p>
						<h3>Clean Architecture</h3>
					</section>
					<section>
						<img src="images/clean-architecture.jpg" alt="Clean Architecture Image" />
					</section>
					<section>
						<blockquote cite="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">
							&ldquo;... the circles are schematic. You may find that you need more than just these four.
							There’s no rule that says you must always have just these four.
							However, The Dependency Rule always applies...&rdquo;
							(Uncle Bob)
						</blockquote>
					</section>
					<section>
						<h4>I will use this schema instead of the first one</h4>
						<img src="images/clean-architecture-real-life-clean-architecture.jpg" />
					</section>
				</section>

				<section>
					<h3>How can we implement in Python?</h3>
				</section>

				<section>
					<h4>We going to use these frameworks/libraries</h4>
					<ul>
						<li>
							<a href="https://flask.palletsprojects.com/en/1.1.x/">
								Flask
							</a>, to serve our Application
						</li>
						<li>
							<a href="https://punq.readthedocs.io/en/latest/">
								punq
							</a>, for Dependency Injection
						</li>
						<li>
							<a href="https://www.sqlalchemy.org/">
								SQLAlchemy
							</a>, for Database interaction
						</li>
						<li>
							<a href="https://pydantic-docs.helpmanual.io/">
								Pydantic
							</a>, for Runtime Type Checking
						</li>
						<li>
							<a href="https://returns.readthedocs.io/en/latest/">
								returns
							</a>, to help us write better code
						</li>
						<li>
							<a href="https://docs.pytest.org/en/latest/">
								pytest
							</a>, for tests
						</li>
						<li>
							<a href="http://mypy-lang.org/">
								mypy
							</a>, for Static Type Checking
						</li>
						<li>
							<a href="https://python-poetry.org/">
								Poetry
							</a>, for Dependency Management
						</li>
					</ul>
				</section>

				<section data-markdown>
					<textarea data-template>
						## Folder Structure
						```text
						clean-architecture-python/
						├── clean-architecture-python/
						│	├── configuration/
						│	├── core/
						│	│	├── entity/
						│	│	└── use_case/
						│	├── dataproviders/
						│	├── entrypoints/
						│	├── application.py
						│	├── boot.py
						├── tests/
						├── README.md
						├── pyproject.toml
						└── setup.cfg
						```
					</textarea>
				</section>

				<section>
					<section>
						<h4>Few explanations before we start the code</h4>
					</section>
					<section>
						<p>
							We'll use <strong>Result</strong> container from <strong>returns</strong> library,
							it's basically a container to help us with Railway Oriented Programming paradigm.
						</p>
						<img src="images/railway-oriented-programming-example.png" />
					</section>
					<section>
						<p>Example extracted from <strong>returns</strong> documentation</p>
						<pre data-id="code-animation">
							<code class="python" data-trim data-line-numbers>
								from returns.result import Result, Success, Failure

								def find_user(user_id: int) -> Result['User', str]:
								  user = User.objects.filter(id=user_id)
								  if user.exists():
								    return Success(user[0])
								  return Failure('User was not found')

								user_search_result = find_user(1)
								# => Success(User{id: 1, ...})

								user_search_result = find_user(0)  # id 0 does not exist!
								# => Failure('User was not found')
							</code>
						</pre>
					</section>
				</section>

				<section>
					<h1>Let's code!!</h1>
				</section>

				<section>
					<h4>References</h4>
					<ul>
						<li>
							<a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">
								The Clean Architecture by Robert C. Martin (Uncle Bob)
							</a>
						</li>
						<li>
							<a href="https://pt.slideshare.net/mattiabattiston/real-life-clean-architecture-61242830">
								Real Life Clean Architecture
							</a>
						</li>
						<li>
							<a href="https://sobolevn.me/2019/03/enforcing-srp">
								Enforcing Single Responsibility Principle in Python
							</a>
						</li>
						<li>
							<a href="https://fsharpforfunandprofit.com/rop">
								Railway Oriented Programming
							</a>
						</li>
					</ul>
				</section>

				<section>
					<h2>Thanks!</h2>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
